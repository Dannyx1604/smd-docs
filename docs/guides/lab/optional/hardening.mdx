---
description: Device hardening guide and and explantion of the tools used to complete such activities.
slug: /lab/hardening
---

# Device Hardening

This document is designed specifcally for those who want to tighten up windows and add some preventative measures to lock down their machine, it should be made known that the more you lock down a machine the less functionality it will have. 

You should find a balance for your own environment that works best for you by either disabling or enhancing the provided policies, this page breaks down the NCSC guidelines for systems hosting '[OFFICAL](https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/286667/FAQ2_-_Managing_Information_Risk_at_OFFICIAL_v2_-_March_2014.pdf)' data. 


### Windows Home Considerations 

As home based editions of Windows cannot use Group Policy below are some things you should look into securing and enabling.

- Principle of least privilege 
- Configure NTFS permissions on additional network drives / shares that are available
- Ensuring automatic updates are configured 
- Disable legacy features 
  - Internet Explorer 
  - SMB 1.0
- Every useless program is another entry point for malware
- Configure Windows Security
  - Enable reputation based scanning
  - Core Isolation
    - Memory Integrity 
  - Exploit Protection 
    - Control Flow Guard
    - Data Execution Protection 
    - Mandatory ASLR 
- Autoplay settings 
- Disable 24/7 Bluetooth discoverability

### Windows Policies 

You can download the Group Policy template files from [here](https://github.com/ukncsc/Device-Security-Guidance-Configuration-Packs/raw/main/Microsoft/Windows/GPO/NCSC_Windows_GPO.zip).

#### App Guard Policies 

The Windows App Guard policy will make the following changes to your PC.

- General hardening of Defender App Guard policies.

#### App Locker Policies 

The Windows App Locker policy will make the following changes to your PC.

- Allows execution of Microsoft signed applications, dlls, installers, scripts and appx

#### Bitlocker Policies 

The Windows bitlocker policy will make the following changes to your PC.

- Disables standby mode when sleeping
- Encrypts the drive with XTS-AES 128
- Disables devices such as thunderbolt that have direct memory access while a device is sleeping
- TPM bitlocker settings are configured 
- Deny write access to removable media for devices configured to work with another organisation

#### Computer Policies 

The Windows computer policy will make the following changes to your PC.

- Prevents login with personal Microsoft accounts 
- Disables user trusted root CAs
- Disables the ability for users to trust certificates
- Defines trusted root CAs for the device to use 
- Prevents lock screen camera
- Requires a domain admin to change network location
- Defines proxy values 
- Prevents installation of devices that match X hardware IDs
- Prevents installation of devices that use drivers matching X setup classes 
- Disables Windows 'PC-Phone' link 
- Disables sign-in with picture login 
- Disables clipboard history
- Disables clipboard sync across devices 
- Disables upload and publishing of user activities
- Disables activity feed 
- Blocks universal windows apps from launching with Windows runtime API 
- Removes the display password button on login forms 
- Disables telemetry gathering
- Disables diagnostic data viewer
- Disables windows-to-go 
- Disables cortana 
- Disables search the web in windows start menu 
- Disables all store applications within the MS Store 
- Disables the MS Store 
- Disables syncronisation of windows settings 
- Ensures defender is enabled
- Disables windows error reporting 
- Ensures Windows Hello is enabled for TPM 2.0 and disables lower 
- Removes access to 'pause windows updates'
- Disables preview builds of windows
- Ensures a semi-annual release channel is configured using Windows update for business 
- Disables Edge data collection
- Disables further telemetry 
- Removes local password reset questions
- Edge pre-loading tabs disabled
- Edge extension sideloading disabled 
- Blocks non-admins from enterting the device into safe-mode 

#### Device Guard 

The Windows device guard policy will make the following changes to your PC.

- Enables virtualisation based securty 
- Ensures code integrity
- Ensures credential guard is configured 
- Ensures secure boot and direct memory access protection is configured

#### Device Health 

This policy can be considered optional unless the device is enrolled into SCCM or another MDM platform.

- Enables Device Health monitoring and reporting services

#### Firewall Settings 

You should add further rules here if additional services are required for the network otherwise additional device / group based policies should be created using the 'Duplicate' feature and adding additional policies.

- Enables Windows firewall 
- Blocks inbound connections (unless explicitly stated)
- Allows outbound connections
- For both 'Private' and 'Personal' network settings outbound connections are blocked
- Configures outbound rules for the following services
  - DHCP
  - DNS
  - Kerbose
  - LDAP
  - NCSI Probe

#### OneDrive Settings 

This policy is entirely optional for home / lab environments where Office 365 business / dev subscriptions are not present.

- Prevents personal OneDrive accounts syncing

#### User Settings 

This policy is entirely optional but recommended for laptops / busy environments.

- Ensures screen lockout time is set to 600 seconds

#### Windows Defender 

The Windows defender policy will make the following changes to your PC.

- Enables block on first sight
- Enrolls device to Microsoft MAPs (requirement for 'block on first sight' to work)
- Send sample file analysis
- Ensures real-time protection is enabled
- Prevents app installation from sources outside of the Microsoft Store
- Ensures smart screen is configured for Windows
- Ensures smart screen is configured for Edge 
- Prevents you from being able to bypass the smartscreen prompt 

#### Installation Guide 

For Active Directory deployments you should use `Group Policy Management Editor` to import the policies.

For single machine deployments you should consider `Powershell` to import the policies, the below command may help.

```powershell 

... 

import-gpo -BackupId {folder-name} -TargetName {gpo} -path {c:\full\path\to\folder} -CreateIfNeeded 

... 
```

#### Closing Thoughts 

From using these settings within our own environment you will want to make some changes, most specifically in the following areas.

- Windows Firewall (opening RDP will prevent you needing to use proxmox viewer)
- App Guard (you will want to add any core non-ms apps you use in this policy e.g. chrome, firefox, vscode... anything that isn't published by Microsoft Corporation)

---

### Ubuntu Script

You can download the post-deployment bash script from [here](https://github.com/ukncsc/Device-Security-Guidance-Configuration-Packs/tree/main/Linux/UbuntuLTS) and manually run it on the server.

Ubuntu, unlike Microsoft, does not require a certain edition for the script to work, at the time of writing this script worked on the latest LTS build of Ubuntu.

#### Script break down

- Firstly the script must be run as 'sudo'
- Secondly it will fetch the admin user
- You will then need to select the administrator account that you created during installation
- You will confirm the app repositories 
- The system will complete an update, upgrade and install app armour
- Grub password is configured 
- Automatic updates are configured 
- Prevents standard users executing as `super user`
- Protects home directories 
- Modified shell access for other users on the machine except admin account specified
- Configures pw complexity
- Enables app armour 
- Enables system audting
- Disables error reporting service 
- Option to disable Bluetooth
- Configures 600s lock screen timer 
- Modifies lockscreen behaviour
- Optional settings for location services, privacy and usb restrictions
- Fixes folder permissions
- Sets up UFW without any rules